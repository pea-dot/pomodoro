<script>
let totalSeconds = 25 * 60; // 25 phút
let currentSeconds = totalSeconds;
let running = false;
let interval;

const timerEl = document.getElementById('timer');
const hpEl = document.getElementById('hp');
const victoryEl = document.getElementById('victory');
const defeatEl = document.getElementById('defeat');
const startBtn = document.getElementById('startBtn');

function updateTimer() {
  let m = Math.floor(currentSeconds / 60);
  let s = currentSeconds % 60;
  timerEl.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

function updateHP() {
  let ratio = currentSeconds / totalSeconds;
  hpEl.style.width = (ratio * 100) + '%';
}

function victory() {
  victoryEl.style.display = 'block';
  running = false;
  clearInterval(interval);
}

function defeat() {
  defeatEl.style.display = 'block';
  running = false;
  clearInterval(interval);
}

function startBattle() {
  if (running) return;
  running = true;
  startBtn.style.display = 'none';
  victoryEl.style.display = 'none';
  defeatEl.style.display = 'none';
  currentSeconds = totalSeconds;
  updateTimer();
  updateHP();

  interval = setInterval(() => {
    currentSeconds--;
    updateTimer();
    updateHP();

    if (currentSeconds <= 0) {
      victory();
    }
  }, 1000);
}

// Detect tab change → defeat
let hidden, visibilityChange;
if (typeof document.hidden !== "undefined") {
  hidden = "hidden";
  visibilityChange = "visibilitychange";
}

document.addEventListener(visibilityChange, () => {
  if (document.hidden && running) defeat();
});

startBtn.addEventListener('click', startBattle);
</script>
